set cut_paste_input [stack 0]
version 15.1 v4
push $cut_paste_input
NoOp {
 name Unreal_Nuke_Converter_PM
 tile_color 0xffff00ff
 selected true
 xpos 1870
 ypos 347
 hide_input true
 addUserKnob {20 User l Unreal_Nuke_Converter_PM}
 addUserKnob {26 ""}
 addUserKnob {26 _0 l "" +STARTLINE T "1, Select Camera node\n2, Push Convert button"}
 addUserKnob {22 convert l CONVERT -STARTLINE T "#code by Peter Mercell 2024\n\nimport nuke\nimport math\n\n# Ensure there's only one selected Camera3 node\nselected_nodes = nuke.selectedNodes('Camera3')\nif len(selected_nodes) != 1:\n    raise RuntimeError(\"Please select exactly one Camera3 node.\")\n\n# Get the reference node\nref_node = selected_nodes\[0]\n\n# Disable reading from file in the reference node\nref_node\['read_from_file'].setValue(False)\n\n# Get the frame range\nstart_frame = nuke.root().firstFrame()\nend_frame = nuke.root().lastFrame()\n\n# Create a new Camera3 node to apply transformations\nAxisResult = nuke.createNode(\"Camera3\")\nAxisResult.setName(\"Camera_Result\")\n\n# Access the knobs of the new Camera3 node\ntranslate_knob = AxisResult\['translate']\nrotate_knob = AxisResult\['rotate']\n\n# Set animated flags for the knobs\ntranslate_knob.setAnimated()\nrotate_knob.setAnimated()\n\n# Extract translation data from the reference node for each frame\nTranslateList = \[]\nfor frame in range(start_frame, end_frame + 1):\n    x_translation = ref_node\['translate'].valueAt(frame, 0)  # x translation\n    y_translation = ref_node\['translate'].valueAt(frame, 1)  # y translation\n    z_translation = ref_node\['translate'].valueAt(frame, 2)  # z translation\n    TranslateList.append((frame, x_translation, y_translation, z_translation))\n\n# Set keyframes for translation in the new Camera3 node\nfor frame, x, y, z in TranslateList:\n    translate_knob.setValueAt(x, frame, 0)  # Set x translation\n    translate_knob.setValueAt(y, frame, 1)  # Set y translation\n    translate_knob.setValueAt(z, frame, 2)  # Set z translation\n\n# Extract rotation data from the reference node for each frame\nRotateList = \[]\nfor frame in range(start_frame, end_frame + 1):\n    x_rotation = ref_node\['rotate'].valueAt(frame, 0)  # x translation\n    y_rotation = ref_node\['rotate'].valueAt(frame, 1)  # y translation\n    z_rotation = ref_node\['rotate'].valueAt(frame, 2)  # z translation\n    RotateList.append((frame, x_rotation, y_rotation, z_rotation))\n\n# Set keyframes for translation in the new Camera3 node\nfor frame, x, y, z in RotateList:\n    rotate_knob.setValueAt((-1*y), frame, 0)  # Set x translation\n    rotate_knob.setValueAt(((z)-90), frame, 1)  # Set y translation\n    rotate_knob.setValueAt(((-1*(x))+90), frame, 2)  # Set z translation\n\n#####\n\nfocal_knob = AxisResult\['focal']\nhaperture_knob = AxisResult\['haperture']\nvaperture_knob = AxisResult\['vaperture']\nnear_knob = AxisResult\['near']\nfar_knob = AxisResult\['far']\nwinroll_knob = AxisResult\['winroll']\nfocal_point_knob = AxisResult\['focal_point']\nfstop_knob = AxisResult\['fstop']\n\nfocal_knob.setAnimated()\nhaperture_knob.setAnimated()\nvaperture_knob.setAnimated()\nnear_knob.setAnimated()\nfar_knob.setAnimated()\nwinroll_knob.setAnimated()\nfocal_point_knob.setAnimated()\nfstop_knob.setAnimated()\n\n# Optional: Set additional values or animations\nAxisResult\['shutteroffset'].setValue(0)\n\nfor frame in range(start_frame, end_frame + 1):\n    # Fetch the focal value from the child node at the current frame\n    focal_value = ref_node\['focal'].valueAt(frame)\n    haperture_value = ref_node\['haperture'].valueAt(frame)\n    vaperture_value = ref_node\['vaperture'].valueAt(frame)\n    near_value = ref_node\['near'].valueAt(frame)\n    far_value = ref_node\['far'].valueAt(frame)\n    win_translate_value = ref_node\['win_translate'].valueAt(frame)\n    win_scale_value = ref_node\['win_scale'].valueAt(frame)\n    winroll_value = ref_node\['winroll'].valueAt(frame)\n    focal_point_value = ref_node\['focal_point'].valueAt(frame)\n    fstop_value = ref_node\['fstop'].valueAt(frame)\n\n    # Set the fetched value to the focal knob of the Camera_Result node\n    focal_knob.setValueAt(focal_value, frame)\n    haperture_knob.setValueAt(haperture_value, frame)\n    vaperture_knob.setValueAt(vaperture_value, frame)\n    near_knob.setValueAt(near_value, frame)\n    far_knob.setValueAt(far_value, frame)\n    #win_translate_knob.setValueAt(win_translate_value, frame)\n    #win_scale_knob.setValueAt(win_scale_value, frame)\n    winroll_knob.setValueAt(winroll_value, frame)\n    focal_point_knob.setValueAt(focal_point_value, frame)\n    fstop_knob.setValueAt(fstop_value, frame)\n"}
 addUserKnob {26 ""}
 addUserKnob {26 _2 l "" +STARTLINE T "Unreal_Nuke_Converter v0.99 by Peter Mercell 2024"}
 addUserKnob {26 _1 l "" +STARTLINE T "<a style=\"color: #999999;\"><a style=\"color: #999999;\" href=\"http://www.petermercell.com\" target=\"_blank\" rel=\"noopener\">www.petermercell.com</a>"}
}
